## HTTPS原理图

### 加密算法

>- 对称加密 （RSA）
>- 非对称加密 （DES、AES）

#### 什么是对称加密和非对称加密

- 对称加密是指加密和解密使用的是同一份密钥，优点是运行速度快，缺点是要解决如何把密钥交给另一方。常见的对称加密算法DEC
- 非对称加密指的是加密和解密使用不同的密钥，一把是公钥，一把是私钥。公钥加密的数据，只能用对应的私钥才能将数据解密。优点是解决了对称加密中的问题，缺点是运行速度慢。常见的非对称加密算法有RSA、DSA等
- 非对称加密算法的工作流程：A生成一对非对称密钥，B生成一对非对称密钥，双方互相交换公钥。当A向B发送信息时，A通过B的公钥加密信息，且经过加密后的信息只有B的私钥能解密。通过这种机制，双方就能实现安全的信息交流。

###  HTTPS原理解析

<img src="https://ldt-typora.oss-cn-shenzhen.aliyuncs.com/img/image-20220309190207238.png" alt="image-20220309190207238" style="zoom:50%;" />

> HTTPS的整个通讯过程分为两个阶段：一个是证书验证阶段，另一个是数据传输阶段，其中数据传输阶段又可以分为非对称加密和对称加密。

1. 客户端请求 HTTPS 网址，然后连接到 server 的 443 端口 (HTTPS 默认端口，类似于 HTTP 的80端口)。

2. 采用 HTTPS 协议的服务器必须要有一套数字 CA (Certification Authority)证书，证书是需要申请的，并由专门的数字证书认证机构(CA)通过非常严格的审核之后颁发的电子证书 (当然了是要钱的，安全级别越高价格越贵)。颁发证书的同时会产生一个私钥和公钥。私钥由服务端自己保存，不可泄漏。**公钥则是附带在证书的信息中，可以公开的**。证书本身也附带一个证书电子签名，这个签名用来验证证书的完整性和真实性，可以防止证书被篡改。

3. 服务器响应客户端请求，将证书传递给客户端，证书包含公钥和大量其他信息，比如证书颁发机构信息，公司信息和证书有效期等。Chrome 浏览器点击地址栏的锁标志再点击证书就可以看到证书详细信息。

   ![CA证书.png](https://ldt-typora.oss-cn-shenzhen.aliyuncs.com/img/bVbClUt.png)

4. 客户端解析证书并对其进行验证。如果证书不是可信机构颁布，或者证书中的域名与实际域名不一致，或者证书已经过期，就会向访问者显示一个警告，由其选择是否还要继续通信。就像下面这样：
   ![浏览器安全警告.png](https://ldt-typora.oss-cn-shenzhen.aliyuncs.com/img/bVbClUs.png)

如果证书没有问题，客户端就会从服务器证书中取出服务器的公钥A。然后客户端还会生成一个随机码 KEY，并使用公钥A将其加密。

5. 客户端把加密后的随机码 KEY 发送给服务器，作为后面对称加密的密钥。
6. 服务器在收到随机码 KEY 之后会使用私钥B将其解密。经过以上这些步骤，客户端和服务器终于建立了安全连接，完美解决了对称加密的密钥泄露问题，接下来就可以用对称加密愉快地进行通信了。
7. 服务器使用密钥 (随机码 KEY)对数据进行对称加密并发送给客户端，客户端使用相同的密钥 (随机码 KEY)解密数据。
8. 双方使用对称加密愉快地传输所有数据。



## SSL/TLS工作原理和详细握手过程

### SSL/TLS以及SSL/TLS握手概念

SSL和TLS协议可以为通讯提供识别和认证通道，从而保证数据的机密性和完整性。TLS协议是从Netscape SSL 3.0演变而来的，不过这两种协议不兼容，TLS逐渐取代SSL协议。

TLS握手是启动HTTPS通讯的过程，类似于TCP连接建立时的三次握手。在TLS握手的过程中，通讯的双方交换信息以相互验证，相互确认，并确认他们所使用的TLS协议的版本号以及会话密钥。因此，TLS握手是HTTPS通讯的基础。

### TLS握手过程中发生了什么

- 商定双方所使用的TLS版本
- 确认双方所使用的密码组合
- 客户端通过公钥和数字证书中的数字签名验证服务器的身份
- 生成会话密钥，该密钥用于握手结束后的对称加密

### TLS握手过程中的一些概念

#### 1、数字证书

在非对称加密中，服务器将公钥发送给客户端，在这个过程中，公钥很有可能被第三方截获并替换，然后第三方就可以冒充服务器与客户端通讯。解决此问题就需要通过信任的第三方交换公钥，具体的做法就是服务器不直接发送公钥给客户端，而是要求信任的第三方，也就是证书认证机构（CA）将公钥合并在数字证书中，然后服务器将数字证书送给客户端，私钥则由服务器保管已确保安全。

>数字证书解决了如何安全的发放公钥的问题，奠定了信任链的基础

![image-20220324163027259](https://ldt-typora.oss-cn-shenzhen.aliyuncs.com/img/image-20220324163027259.png)

#### 2、数字签名

其实跟人的手写签名类似，是为了确保数据发送者的合法身份，也可以确保数据未遭到篡改，保证数据的完整性。与手写签名不同的是，数字签名是随着内容的变化而变化的。

#### 3、证书链

证书链，也称为证书路径，是用于认证实体合法身份的证书列表，具体到 HTTPS 通信中，就是为了验证服务器的合法身份。



## HTTP和HTTPS协议的区别

|              |          HTTP          |                  HTTPS                  |
| :----------: | :--------------------: | :-------------------------------------: |
|     端口     |           80           |                   443                   |
|    安全性    |   无加密，安全性较差   |         有加密机制，安全性较高          |
|   资源消耗   |          较少          |       由于加密处理，资源消耗更多        |
| 是否需要证书 |         不需要         |                  需要                   |
|     协议     |   运行在TCP协议之上    | 运行在SSL协议之上，SSL运行在TCP协议之上 |
|     信息     | 超文本传输（明文传输） |                加密传输                 |

**什么是SSL协议？**

SSL协议可分为两层： SSL记录协议（SSL Record Protocol）：它建立在可靠的传输协议（如TCP）之上，为高层协议提供数据封装、压缩、加密等基本功能的支持。 SSL握手协议（SSL Handshake Protocol）：它建立在SSL记录协议之上，用于在实际的数据传输开始前，通讯双方进行身份认证、协商加密算法、交换加密密钥等。



##  HTTP 1.0、HTTP 1.1及HTTP 2.0的主要区别

###  **HTTP1.0 和 HTTP 1.1的区别**

- **长连接**

  HTTP1.1支持长连接和请求的流水线操作。长连接是不需要每次请求都要建立一次连接，HTTP1.0默认使用短连接，每次发送请求都要建立一次连接，资源消耗较大。请求的流水线操作是指客户端在收到请求响应之前再发送新的HTTP请求，而不支持请求流水线操作的HTTP需要在接收到每次请求响应之后，才能再次发送一个新的请求。

- **HOST域**

  在HTTP1.0 认为每台主机都会拥有唯一的IP地址，因此请求中的URL并没有绑定主机名HOST。但是随着计算机的发展，一个服务器可能有多个虚拟机，它们共享一个IP地址，所以HTTP1.1在URL中增加了对主机名的绑定。

### HTTP 2.0

- **新的二进制格式：**HTTP 1.x 的解析是基于文本的，而HTTP 2.0 的解析采用二进制，实现方便，健壮性更好。比如，HTTP1.X中的首部信息header封装到Headers帧中，而request body将被封装到Data帧中。

- **多路复用：**基于二进制分帧层，HTTP2.0 可以在共享TCP链接的基础上同时发送请求和响应报文。HTTP消息被分解为独立的帧，而不破坏消息本身语义的基础上，交错发出去，在另一段根据流标识符和首部重写组装成一个完整的请求。

- **header的压缩**：HTTP2.0采用编码的方式压缩header的大小，同时通讯的双方各自缓存一份header fields表，避免header里面某些数据重复传输。

  <img src="https://ldt-typora.oss-cn-shenzhen.aliyuncs.com/img/image-20220309195238210.png" alt="image-20220309195238210" style="zoom:50%;" />

- **服务器推送：**客户端发送一个请求时，服务器会把相关的一些请求同时发给客户端。